<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/mobile_app_project/ui/screens/settings/SettingsScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/mobile_app_project/ui/screens/settings/SettingsScreen.kt" />
              <option name="originalContent" value="package com.example.mobile_app_project.ui.screens.settings&#10;&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.HorizontalDivider&#10;import androidx.compose.material3.RadioButton&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import android.net.Uri&#10;import androidx.compose.ui.unit.dp&#10;import androidx.navigation.NavController&#10;import com.example.mobile_app_project.data.local.UserPreferences&#10;import kotlinx.coroutines.CoroutineScope&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.launch&#10;&#10;@Composable&#10;fun SettingsScreen(&#10;    navController: NavController,&#10;    settingsViewModel: com.example.mobile_app_project.viewmodel.SettingsViewModel&#10;) {&#10;    val context = LocalContext.current&#10;    val prefs = UserPreferences(context)&#10;    val scope = CoroutineScope(Dispatchers.IO)&#10;&#10;    val tempUnit by prefs.observeTemperatureUnit().collectAsState(initial = &quot;C&quot;)&#10;    val windUnit by prefs.observeWindUnit().collectAsState(initial = &quot;m_s&quot;)&#10;    val recentCities by prefs.observeRecentCities().collectAsState(initial = emptyList())&#10;&#10;    Column(&#10;        modifier = Modifier.fillMaxSize().padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(12.dp)&#10;    ) {&#10;        Text(&quot;Nastavení&quot;, style = androidx.compose.material3.MaterialTheme.typography.titleLarge)&#10;        Text(&quot;Jednotky teploty&quot;)&#10;        Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            RowWithRadio(label = &quot;Celsius (°C)&quot;, selected = tempUnit == &quot;C&quot;) { scope.launch { prefs.setTemperatureUnit(&quot;C&quot;) } }&#10;            RowWithRadio(label = &quot;Fahrenheit (°F)&quot;, selected = tempUnit == &quot;F&quot;) { scope.launch { prefs.setTemperatureUnit(&quot;F&quot;) } }&#10;        }&#10;        Text(&quot;Jednotky větru&quot;)&#10;        Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            RowWithRadio(label = &quot;m/s&quot;, selected = windUnit == &quot;m_s&quot;) { scope.launch { prefs.setWindUnit(&quot;m_s&quot;) } }&#10;            RowWithRadio(label = &quot;km/h&quot;, selected = windUnit == &quot;km_h&quot;) { scope.launch { prefs.setWindUnit(&quot;km_h&quot;) } }&#10;        }&#10;        HorizontalDivider()&#10;        Text(&quot;Hledané (posledních 20)&quot;)&#10;        if (recentCities.isEmpty()) {&#10;            Text(&quot;Žádné položky&quot;)&#10;        } else {&#10;            LazyColumn(verticalArrangement = Arrangement.spacedBy(4.dp)) {&#10;                items(recentCities) { name -&gt;&#10;                    Text(&#10;                        text = name,&#10;                        modifier = Modifier.clickable {&#10;                            navController.navigate(&quot;detail?cityName=${Uri.encode(name)}&amp;lat=&amp;lon=&quot;)&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        Spacer(modifier = Modifier.padding(4.dp))&#10;        Button(onClick = { scope.launch { prefs.clearRecentCities() } }) { Text(&quot;Smazat historii hledání&quot;) }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun RowWithRadio(label: String, selected: Boolean, onSelect: () -&gt; Unit) {&#10;    androidx.compose.foundation.layout.Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;        RadioButton(selected = selected, onClick = { onSelect() })&#10;        Text(label)&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.mobile_app_project.ui.screens.settings&#13;&#10;&#13;&#10;import androidx.compose.foundation.clickable&#13;&#10;import androidx.compose.foundation.layout.Arrangement&#13;&#10;import androidx.compose.foundation.layout.Column&#13;&#10;import androidx.compose.foundation.layout.Spacer&#13;&#10;import androidx.compose.foundation.layout.fillMaxSize&#13;&#10;import androidx.compose.foundation.layout.padding&#13;&#10;import androidx.compose.foundation.lazy.LazyColumn&#13;&#10;import androidx.compose.foundation.lazy.items&#13;&#10;import androidx.compose.material3.Button&#13;&#10;import androidx.compose.material3.HorizontalDivider&#13;&#10;import androidx.compose.material3.RadioButton&#13;&#10;import androidx.compose.material3.Text&#13;&#10;import androidx.compose.runtime.Composable&#13;&#10;import androidx.compose.runtime.collectAsState&#13;&#10;import androidx.compose.runtime.getValue&#13;&#10;import androidx.compose.ui.Modifier&#13;&#10;import androidx.compose.ui.platform.LocalContext&#13;&#10;import android.net.Uri&#13;&#10;import androidx.compose.ui.unit.dp&#13;&#10;import androidx.navigation.NavController&#13;&#10;import com.example.mobile_app_project.data.local.UserPreferences&#13;&#10;import com.example.mobile_app_project.data.repository.WeatherRepository&#13;&#10;import kotlinx.coroutines.CoroutineScope&#13;&#10;import kotlinx.coroutines.Dispatchers&#13;&#10;import kotlinx.coroutines.launch&#13;&#10;&#13;&#10;@Composable&#13;&#10;fun SettingsScreen(&#13;&#10;    navController: NavController,&#13;&#10;    settingsViewModel: com.example.mobile_app_project.viewmodel.SettingsViewModel&#13;&#10;) {&#13;&#10;    val context = LocalContext.current&#13;&#10;    val prefs = UserPreferences(context)&#13;&#10;    val scope = CoroutineScope(Dispatchers.IO)&#13;&#10;&#13;&#10;    val tempUnit by prefs.observeTemperatureUnit().collectAsState(initial = &quot;C&quot;)&#13;&#10;    val windUnit by prefs.observeWindUnit().collectAsState(initial = &quot;m_s&quot;)&#13;&#10;    val recentCities by prefs.observeRecentCities().collectAsState(initial = emptyList())&#13;&#10;&#13;&#10;    Column(&#13;&#10;        modifier = Modifier.fillMaxSize().padding(16.dp),&#13;&#10;        verticalArrangement = Arrangement.spacedBy(12.dp)&#13;&#10;    ) {&#13;&#10;        Text(&quot;Nastavení&quot;, style = androidx.compose.material3.MaterialTheme.typography.titleLarge)&#13;&#10;        Text(&quot;Jednotky teploty&quot;)&#13;&#10;        Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {&#13;&#10;            RowWithRadio(label = &quot;Celsius (°C)&quot;, selected = tempUnit == &quot;C&quot;) { scope.launch { prefs.setTemperatureUnit(&quot;C&quot;) } }&#13;&#10;            RowWithRadio(label = &quot;Fahrenheit (°F)&quot;, selected = tempUnit == &quot;F&quot;) { scope.launch { prefs.setTemperatureUnit(&quot;F&quot;) } }&#13;&#10;        }&#13;&#10;        Text(&quot;Jednotky větru&quot;)&#13;&#10;        Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {&#13;&#10;            RowWithRadio(label = &quot;m/s&quot;, selected = windUnit == &quot;m_s&quot;) { scope.launch { prefs.setWindUnit(&quot;m_s&quot;) } }&#13;&#10;            RowWithRadio(label = &quot;km/h&quot;, selected = windUnit == &quot;km_h&quot;) { scope.launch { prefs.setWindUnit(&quot;km_h&quot;) } }&#13;&#10;        }&#13;&#10;        HorizontalDivider()&#13;&#10;        Text(&quot;Hledané (posledních 20)&quot;)&#13;&#10;        if (recentCities.isEmpty()) {&#13;&#10;            Text(&quot;Žádné položky&quot;)&#13;&#10;        } else {&#13;&#10;            LazyColumn(verticalArrangement = Arrangement.spacedBy(4.dp)) {&#13;&#10;                items(recentCities) { name -&gt;&#13;&#10;                    Text(&#13;&#10;                        text = name,&#13;&#10;                        modifier = Modifier.clickable {&#13;&#10;                            // Resolve coordinates via repository before navigating&#13;&#10;                            val repo = WeatherRepository()&#13;&#10;                            // This is a Composable context; use IO coroutine scope&#13;&#10;                            scope.launch {&#13;&#10;                                val result = repo.searchCityByName(name)&#13;&#10;                                result.fold(onSuccess = { city -&gt;&#13;&#10;                                    navController.navigate(&quot;detail?cityName=${Uri.encode(city.name)}&amp;lat=${city.latitude}&amp;lon=${city.longitude}&quot;)&#13;&#10;                                }, onFailure = {&#13;&#10;                                    // Optionally show error, but navigate with name fallback&#13;&#10;                                    navController.navigate(&quot;detail?cityName=${Uri.encode(name)}&amp;lat=&amp;lon=&quot;)&#13;&#10;                                })&#13;&#10;                            }&#13;&#10;                        }&#13;&#10;                    )&#13;&#10;                }&#13;&#10;            }&#13;&#10;        }&#13;&#10;        Spacer(modifier = Modifier.padding(4.dp))&#13;&#10;        Button(onClick = { scope.launch { prefs.clearRecentCities() } }) { Text(&quot;Smazat historii hledání&quot;) }&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;@Composable&#13;&#10;private fun RowWithRadio(label: String, selected: Boolean, onSelect: () -&gt; Unit) {&#13;&#10;    androidx.compose.foundation.layout.Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#13;&#10;        RadioButton(selected = selected, onClick = { onSelect() })&#13;&#10;        Text(label)&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/mobile_app_project/viewmodel/WeatherViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/mobile_app_project/viewmodel/WeatherViewModel.kt" />
              <option name="originalContent" value="package com.example.mobile_app_project.viewmodel&#10;&#10;import android.annotation.SuppressLint&#10;import android.content.Context&#10;import android.location.Location&#10;import android.Manifest&#10;import android.content.pm.PackageManager&#10;import androidx.core.content.ContextCompat&#10;import com.google.android.gms.location.LocationServices&#10;import kotlinx.coroutines.suspendCancellableCoroutine&#10;import kotlin.coroutines.resume&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.mobile_app_project.data.local.UserPreferences&#10;import com.example.mobile_app_project.data.repository.WeatherRepository&#10;import com.example.mobile_app_project.data.repository.model.CityCoordinates&#10;import com.example.mobile_app_project.data.repository.model.WeatherData&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.flow.filterNotNull&#10;import kotlinx.coroutines.launch&#10;&#10;class WeatherViewModel(&#10;    private val repository: WeatherRepository,&#10;    private val preferences: UserPreferences&#10;) : ViewModel() {&#10;&#10;    private val _uiState = MutableStateFlow(WeatherUiState())&#10;    val uiState: StateFlow&lt;WeatherUiState&gt; = _uiState.asStateFlow()&#10;&#10;    // Remove auto-load of last city to keep Home showing only current location weather&#10;    // init { /* intentionally disabled */ }&#10;&#10;    fun onCityNameChange(name: String) {&#10;        _uiState.value = _uiState.value.copy(cityName = name, errorMessage = null)&#10;    }&#10;&#10;    // Keep method for loading by city if needed elsewhere (e.g., Detail)&#10;    fun loadWeatherForCity(name: String) {&#10;        viewModelScope.launch {&#10;            _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;&#10;            repository.searchCityByName(name).fold(&#10;                onSuccess = { city: CityCoordinates -&gt;&#10;                    fetchForecastAndPersist(city)&#10;                },&#10;                onFailure = { err -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;                }&#10;            )&#10;        }&#10;    }&#10;&#10;    private suspend fun fetchForecastAndPersist(city: CityCoordinates) {&#10;        preferences.saveLastCityName(city.name)&#10;        val forecastResult = repository.getWeatherForCoordinates(city.latitude, city.longitude, city.name)&#10;        forecastResult.fold(onSuccess = { data: WeatherData -&gt;&#10;            // Do not override Home's current location weather if search triggered&#10;            _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = null)&#10;        }, onFailure = { err -&gt;&#10;            _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;        })&#10;    }&#10;&#10;    fun loadWeatherForCurrentLocation(context: Context) {&#10;        viewModelScope.launch {&#10;            _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;            val coords = getCurrentCoordinates(context)&#10;            if (coords != null) {&#10;                val (lat, lon) = coords&#10;                repository.getWeatherForCoordinates(lat, lon).fold(onSuccess = { data -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, weatherData = data, errorMessage = null)&#10;                }, onFailure = { err -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;                })&#10;            } else {&#10;                _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = &quot;Nelze získat aktuální polohu (zkontrolujte oprávnění)&quot;)&#10;            }&#10;        }&#10;    }&#10;&#10;    @SuppressLint(&quot;MissingPermission&quot;)&#10;    private suspend fun getCurrentCoordinates(context: Context): Pair&lt;Double, Double&gt;? {&#10;        val fineGranted = ContextCompat.checkSelfPermission(context, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED&#10;        val coarseGranted = ContextCompat.checkSelfPermission(context, Manifest.permission.ACCESS_COARSE_LOCATION) == PackageManager.PERMISSION_GRANTED&#10;        if (!fineGranted &amp;&amp; !coarseGranted) return null&#10;&#10;        val fused = LocationServices.getFusedLocationProviderClient(context)&#10;        val last = suspendCancellableCoroutine&lt;Location?&gt; { cont -&gt;&#10;            fused.lastLocation.addOnSuccessListener { loc -&gt;&#10;                if (!cont.isCancelled) cont.resume(loc)&#10;            }.addOnFailureListener { _ -&gt;&#10;                if (!cont.isCancelled) cont.resume(null)&#10;            }&#10;        }&#10;        val loc = last ?: suspendCancellableCoroutine&lt;Location?&gt; { cont -&gt;&#10;            fused.getCurrentLocation(com.google.android.gms.location.Priority.PRIORITY_BALANCED_POWER_ACCURACY, null)&#10;                .addOnSuccessListener { l -&gt; if (!cont.isCancelled) cont.resume(l) }&#10;                .addOnFailureListener { _ -&gt; if (!cont.isCancelled) cont.resume(null) }&#10;        }&#10;        return loc?.let { it.latitude to it.longitude }&#10;    }&#10;&#10;    fun searchAndNavigate(name: String, navController: androidx.navigation.NavController) {&#10;        viewModelScope.launch {&#10;            _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;            repository.getWeatherForCityName(name).fold(onSuccess = { data: WeatherData -&gt;&#10;                // Add to recent searches&#10;                preferences.addRecentCity(data.cityName)&#10;                // Do not set weatherData to keep Home pinned to current location&#10;                _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = null)&#10;                navController.navigate(&quot;detail?cityName=${data.cityName}&amp;lat=${data.latitude}&amp;lon=${data.longitude}&quot;)&#10;            }, onFailure = { err -&gt;&#10;                _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;City not found&quot;)&#10;            })&#10;        }&#10;    }&#10;&#10;    // Explicitly load forecast for given coordinates (used by Detail)&#10;    fun loadForecastForCoordinates(lat: Double, lon: Double, cityNameHint: String? = null) {&#10;        viewModelScope.launch {&#10;            _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;            repository.getWeatherForCoordinates(lat, lon, cityNameHint ?: &quot;&quot;)&#10;                .fold(onSuccess = { data: WeatherData -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, weatherData = data, errorMessage = null)&#10;                }, onFailure = { err -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;                })&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.mobile_app_project.viewmodel&#10;&#10;import android.annotation.SuppressLint&#10;import android.content.Context&#10;import android.location.Location&#10;import android.Manifest&#10;import android.content.pm.PackageManager&#10;import androidx.core.content.ContextCompat&#10;import com.google.android.gms.location.LocationServices&#10;import kotlinx.coroutines.suspendCancellableCoroutine&#10;import kotlin.coroutines.resume&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.mobile_app_project.data.local.UserPreferences&#10;import com.example.mobile_app_project.data.repository.WeatherRepository&#10;import com.example.mobile_app_project.data.repository.model.CityCoordinates&#10;import com.example.mobile_app_project.data.repository.model.WeatherData&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.flow.filterNotNull&#10;import kotlinx.coroutines.launch&#10;&#10;class WeatherViewModel(&#10;    private val repository: WeatherRepository,&#10;    private val preferences: UserPreferences&#10;) : ViewModel() {&#10;&#10;    private val _uiState = MutableStateFlow(WeatherUiState())&#10;    val uiState: StateFlow&lt;WeatherUiState&gt; = _uiState.asStateFlow()&#10;&#10;    // Remove auto-load of last city to keep Home showing only current location weather&#10;    // init { /* intentionally disabled */ }&#10;&#10;    fun onCityNameChange(name: String) {&#10;        _uiState.value = _uiState.value.copy(cityName = name, errorMessage = null)&#10;    }&#10;&#10;    // Keep method for loading by city if needed elsewhere (e.g., Detail)&#10;    fun loadWeatherForCity(name: String) {&#10;        viewModelScope.launch {&#10;            _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;&#10;            repository.searchCityByName(name).fold(&#10;                onSuccess = { city: CityCoordinates -&gt;&#10;                    fetchForecastAndPersist(city)&#10;                },&#10;                onFailure = { err -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;                }&#10;            )&#10;        }&#10;    }&#10;&#10;    private suspend fun fetchForecastAndPersist(city: CityCoordinates) {&#10;        preferences.saveLastCityName(city.name)&#10;        val forecastResult = repository.getWeatherForCoordinates(city.latitude, city.longitude, city.name)&#10;        forecastResult.fold(onSuccess = { data: WeatherData -&gt;&#10;            // Do not override Home's current location weather if search triggered&#10;            _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = null)&#10;        }, onFailure = { err -&gt;&#10;            _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;        })&#10;    }&#10;&#10;    fun loadWeatherForCurrentLocation(context: Context) {&#10;        viewModelScope.launch {&#10;            _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;            val coords = getCurrentCoordinates(context)&#10;            if (coords != null) {&#10;                val (lat, lon) = coords&#10;                repository.getWeatherForCoordinates(lat, lon).fold(onSuccess = { data -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, weatherData = data, errorMessage = null)&#10;                }, onFailure = { err -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;                })&#10;            } else {&#10;                _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = &quot;Nelze získat aktuální polohu (zkontrolujte oprávnění)&quot;)&#10;            }&#10;        }&#10;    }&#10;&#10;    @SuppressLint(&quot;MissingPermission&quot;)&#10;    private suspend fun getCurrentCoordinates(context: Context): Pair&lt;Double, Double&gt;? {&#10;        val fineGranted = ContextCompat.checkSelfPermission(context, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED&#10;        val coarseGranted = ContextCompat.checkSelfPermission(context, Manifest.permission.ACCESS_COARSE_LOCATION) == PackageManager.PERMISSION_GRANTED&#10;        if (!fineGranted &amp;&amp; !coarseGranted) return null&#10;&#10;        val fused = LocationServices.getFusedLocationProviderClient(context)&#10;        val last = suspendCancellableCoroutine&lt;Location?&gt; { cont -&gt;&#10;            fused.lastLocation.addOnSuccessListener { loc -&gt;&#10;                if (!cont.isCancelled) cont.resume(loc)&#10;            }.addOnFailureListener { _ -&gt;&#10;                if (!cont.isCancelled) cont.resume(null)&#10;            }&#10;        }&#10;        val loc = last ?: suspendCancellableCoroutine&lt;Location?&gt; { cont -&gt;&#10;            fused.getCurrentLocation(com.google.android.gms.location.Priority.PRIORITY_BALANCED_POWER_ACCURACY, null)&#10;                .addOnSuccessListener { l -&gt; if (!cont.isCancelled) cont.resume(l) }&#10;                .addOnFailureListener { _ -&gt; if (!cont.isCancelled) cont.resume(null) }&#10;        }&#10;        return loc?.let { it.latitude to it.longitude }&#10;    }&#10;&#10;    fun searchAndNavigate(name: String, navController: androidx.navigation.NavController) {&#10;        viewModelScope.launch {&#10;            _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;            repository.getWeatherForCityName(name).fold(onSuccess = { data: WeatherData -&gt;&#10;                // Add to recent searches&#10;                preferences.addRecentCity(data.cityName)&#10;                // Do not set weatherData to keep Home pinned to current location&#10;                _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = null)&#10;                navController.navigate(&quot;detail?cityName=${data.cityName}&amp;lat=${data.latitude}&amp;lon=${data.longitude}&quot;)&#10;            }, onFailure = { err -&gt;&#10;                _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;City not found&quot;)&#10;            })&#10;        }&#10;    }&#10;&#10;    // Explicitly load forecast for given coordinates (used by Detail)&#10;    fun loadForecastForCoordinates(lat: Double, lon: Double, cityNameHint: String? = null) {&#10;        viewModelScope.launch {&#10;            _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;            repository.getWeatherForCoordinates(lat, lon, cityNameHint ?: &quot;&quot;)&#10;                .fold(onSuccess = { data: WeatherData -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, weatherData = data, errorMessage = null)&#10;                }, onFailure = { err -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;                })&#10;        }&#10;    }&#10;&#10;    // Load weather by city for Detail (sets weatherData)&#10;    fun loadWeatherForCityDetail(name: String) {&#10;        viewModelScope.launch {&#10;            _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;            repository.searchCityByName(name).fold(&#10;                onSuccess = { city: com.example.mobile_app_project.data.repository.model.CityCoordinates -&gt;&#10;                    repository.getWeatherForCoordinates(city.latitude, city.longitude, city.name).fold(&#10;                        onSuccess = { data -&gt;&#10;                            _uiState.value = _uiState.value.copy(isLoading = false, weatherData = data, errorMessage = null)&#10;                        },&#10;                        onFailure = { err -&gt;&#10;                            _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;                        }&#10;                    )&#10;                },&#10;                onFailure = { err -&gt;&#10;                    _uiState.value = _uiState.value.copy(isLoading = false, errorMessage = err.message ?: &quot;Unknown error&quot;)&#10;                }&#10;            )&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>